

source /opt/gsat/gsui_functions.sh

check_exists DOMAIN

mkdir -p /var/log/nginx/$DOMAIN

DEST_DIR=/var/www/cloudify-widget-ui

cat <<END

upstream cloudify-widget-ui-backend {
         server localhost:9040;
       }

server {

  listen        80;
  server_name   $DOMAIN;
  access_log    /var/log/nginx/$DOMAIN/access.log;
  error_log     /var/log/nginx/$DOMAIN/error.log;
  error_page    404    /404.html;
  error_page    503    /503.html;

  rewrite  ^/$  /index.html  last;

 location /backend{
      proxy_pass http://cloudify-widget-ui-backend;
 }

  location / {
    autoindex off;
    root $DEST_DIR/dist;
  }

}
END
